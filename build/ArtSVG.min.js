/**
 * ArtSVG.min.js
 * @fileoverview HTML5 SVG Library
 *
 * Copyright (c) 2013 Tomohiro IKEDA (Korilakkuma)
 * Released under the MIT license
 */
!function(a){"use strict";function b(c,d,e,f){this.container=document.body,this.svg=null,c instanceof HTMLElement&&(this.container=c),d instanceof SVGElement?this.svg=d:(this.svg=document.createElement("svg"),this.container.appendChild(d)),this.svg.setAttribute("xmlns",b.XMLNS),this.svg.setAttribute("xmlns:xlink",b.XLINK);var g=parseInt(e),h=parseInt(f);this.container.style.width=g>0?g+"px":b.DEFAULT_SIZES.WIDTH+"px",this.container.style.height=h>0?h+"px":b.DEFAULT_SIZES.HEIGHT+"px",this.svg.setAttribute("width",g>0?g:b.DEFAULT_SIZES.WIDTH),this.svg.setAttribute("height",h>0?h:b.DEFAULT_SIZES.HEIGHT),this.drawer=new b.Drawer(this.container),this.history=new b.History(this.svg),this.mode=b.Mode.SELECT,this.drawerType=b.Drawer.Type.PATH,this.selectedElements=[];var i=this,j=!1,k=function(a){if(a instanceof Event&&a.target!==i.container&&a.target!==i.svg)switch(a.type){case b.MouseEvents.START:i.selectedElements[0]=a.target;break;case b.MouseEvents.MOVE:for(var c=b.Drawer.getOffsetX(a,i.container),d=b.Drawer.getOffsetY(a,i.container),e=0,f=i.selectedElements.length;f>e;e++)i.drawer.move(i.selectedElements[e],c,d);break;case b.MouseEvents.END:i.history.updateHistory()}};this.svg.addEventListener(b.MouseEvents.START,function(a){j||(j=!0,i.mode===b.Mode.SELECT?k(a):i.drawer.draw(a,i.drawerType))},!0),this.svg.addEventListener(b.MouseEvents.MOVE,function(a){j&&(a.preventDefault(),i.mode===b.Mode.SELECT?k(a):i.drawer.draw(a,i.drawerType))},!0),a.addEventListener(b.MouseEvents.END,function(a){j&&(j=!1,i.mode===b.Mode.SELECT?k(a):(i.drawer.draw(a,i.drawerType),i.drawerType!==b.Drawer.Type.TEXT&&i.history.updateHistory()))},!0)}b.XMLNS="http://www.w3.org/2000/svg",b.XLINK="http://www.w3.org/1999/xlink",b.DEFAULT_SIZES={},b.DEFAULT_SIZES.WIDTH=300,b.DEFAULT_SIZES.HEIGHT=300,b.prototype.getContainerWidth=function(){return parseInt(this.container.style.width)},b.prototype.getContainerHeight=function(){return parseInt(this.container.style.height)},b.prototype.getMode=function(){return this.mode},b.prototype.setMode=function(a){String(a).toUpperCase()in b.Mode&&(this.mode=String(a).toLowerCase());var c=this.container.querySelectorAll('[type="text"]');if(c)for(var d=0,e=c.length;e>d;d++)this.container.removeChild(c[d]);return this},b.prototype.getDrawerType=function(){return this.drawerType},b.prototype.setDrawerType=function(a){return this.drawerType===b.Drawer.Type.TEXT&&this.history.updateHistory(),String(a).toUpperCase()in b.Drawer.Type&&(this.drawerType=String(a).toLowerCase()),this},b.prototype.getSelectedElements=function(){return this.selectedElements},b.prototype.undo=function(){return this.history.undo()},b.prototype.redo=function(){return this.history.redo()},b.prototype.clear=function(){return this.drawer.clear(),this.history.updateHistory(),this},b.prototype.drawImage=function(a,b,c){return this.drawer.drawImage(a,b,c),this},b.prototype.getFill=function(){return this.drawer.getFill()},b.prototype.setFill=function(a){return this.drawer.setFill(a),this},b.prototype.getStroke=function(){return this.drawer.getStroke()},b.prototype.setStroke=function(a){return this.drawer.setStroke(a),this},b.prototype.getStrokeWidth=function(){return this.drawer.getStrokeWidth()},b.prototype.setStrokeWidth=function(a){return this.drawer.setStrokeWidth(a),this},b.prototype.getStrokeLinecap=function(){return this.drawer.getStrokeLinecap()},b.prototype.setStrokeLinecap=function(a){return this.drawer.setStrokeLinecap(a),this},b.prototype.getStrokeLinejoin=function(){return this.drawer.getStrokeLinejoin()},b.prototype.setStrokeLinejoin=function(a){return this.drawer.setStrokeLinejoin(a),this},b.prototype.getFontFamily=function(){return this.drawer.getFontFamily()},b.prototype.setFontFamily=function(a){return this.drawer.setFontFamily(a),this},b.prototype.getFontSize=function(){return this.drawer.getFontSize()},b.prototype.setFontSize=function(a){return this.drawer.setFontSize(a),this},b.prototype.getFontStyle=function(){return this.drawer.getFontStyle()},b.prototype.setFontStyle=function(a){return this.drawer.setFontStyle(a),this},b.prototype.getFontWeight=function(){return this.drawer.getFontWeight()},b.prototype.setFontWeight=function(a){return this.drawer.setFontWeight(a),this},function(a){function b(){}var c="",d="",e="",f="";/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(c="click",d="touchstart",e="touchmove",f="touchend"):(c="click",d="mousedown",e="mousemove",f="mouseup"),b.CLICK=c,b.START=d,b.MOVE=e,b.END=f,a.MouseEvents=b}(b),function(a){function b(){}b.SELECT="select",b.DRAW="draw",a.Mode=b}(b),function(a){function b(a,b,c,d){this.red=0,this.green=0,this.blue=0,this.alpha=1;var e=parseInt(a),f=parseInt(b),g=parseInt(c),h=parseFloat(d);!isNaN(e)&&e>=0&&255>=e&&(this.red=e),!isNaN(f)&&f>=0&&255>=f&&(this.green=f),!isNaN(g)&&g>=0&&255>=g&&(this.blue=g),!isNaN(h)&&h>=0&&1>=h&&(this.alpha=h)}b.prototype.getRed=function(){return this.red},b.prototype.getGreen=function(){return this.green},b.prototype.getBlue=function(){return this.blue},b.prototype.getAlpha=function(){return this.alpha},b.prototype.toString=function(){var a="rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")";return a},b.prototype.toHexString=function(){var a="#";return a+=this.red.toString(16)+this.green.toString(16)+this.blue.toString(16)},a.Color=b}(b),function(a){function b(b){this.container=document.body,b instanceof HTMLElement&&(this.container=b),this.numberOfObjects=0,this.attributes={fill:new a.Color(0,0,0,1).toString(),stroke:new a.Color(0,0,0,1).toString(),"stroke-width":1,"stroke-linecap":"butt","stroke-linejoin":"miter"},this.font={"font-family":"Arial","font-size":"16px","font-style":"normal","font-weight":"normal"},this.points={x1:0,y1:0}}function c(){}function d(){}function e(){}function f(){}b.ELEMENT_ID_PREFIX="art-svg-",b.prototype.draw=function(a,c){switch(c){case b.Type.PATH:this.drawPath(a);break;case b.Type.RECTANGLE:this.drawRect(a);break;case b.Type.SQUARE:this.drawSquare(a);break;case b.Type.CIRCLE:this.drawCircle(a);break;case b.Type.ELLIPSE:this.drawEllipse(a);break;case b.Type.LINE:this.drawLine(a);break;case b.Type.TEXT:this.drawText(a)}return this},b.prototype.move=function(a,b,c){return a instanceof SVGPathElement?this.movePath(a,b,c):a instanceof SVGRectElement?this.moveRectangle(a,b,c):a instanceof SVGCircleElement||a instanceof SVGEllipseElement?this.moveEllipse(a,b,c):a instanceof SVGLineElement?this.moveLine(a,b,c):a instanceof SVGTextElement?this.moveText(a,b,c):a instanceof SVGImageElement&&this.moveImage(a,b,c),this},b.prototype.drawPath=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"path"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill","none"),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("stroke-linecap",this.attributes["stroke-linecap"]),d.setAttribute("stroke-linejoin",this.attributes["stroke-linejoin"]),d.setAttribute("d","M"+e+" "+f),this.container.querySelector("svg").appendChild(d);break;case a.MouseEvents.MOVE:d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("d",d.getAttribute("d")+", L"+e+" "+f);break;case a.MouseEvents.END:this.numberOfObjects++}return this},b.prototype.drawRect=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"rect"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill",this.attributes.fill),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("stroke-linejoin",this.attributes["stroke-linejoin"]),d.setAttribute("x",e),d.setAttribute("y",f),this.container.querySelector("svg").appendChild(d),this.points.x1=e,this.points.y1=f;break;case a.MouseEvents.MOVE:d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects);var g=this.points.x1,h=this.points.y1,i=Math.min(e,g),j=Math.min(f,h),k=Math.max(e,g),l=Math.max(f,h),m=Math.abs(k-i),n=Math.abs(l-j);d.setAttribute("x",i),d.setAttribute("y",j),d.setAttribute("width",m),d.setAttribute("height",n);break;case a.MouseEvents.END:this.numberOfObjects++,this.clearPoints()}return this},b.prototype.drawSquare=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"rect"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill",this.attributes.fill),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("stroke-linejoin",this.attributes["stroke-linejoin"]),d.setAttribute("x",e),d.setAttribute("y",f),this.container.querySelector("svg").appendChild(d),this.points.x1=e,this.points.y1=f;break;case a.MouseEvents.MOVE:d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects);var g=this.points.x1,h=this.points.y1,i=Math.min(e,g),j=Math.min(f,h),k=Math.max(e,g),l=Math.max(f,h),m=Math.max(Math.abs(k-i),Math.abs(l-j));d.setAttribute("x",i),d.setAttribute("y",j),d.setAttribute("width",m),d.setAttribute("height",m);break;case a.MouseEvents.END:this.numberOfObjects++,this.clearPoints()}return this},b.prototype.drawCircle=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"circle"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill",this.attributes.fill),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("cx",e),d.setAttribute("cy",f),this.container.querySelector("svg").appendChild(d),this.points.x1=e,this.points.y1=f;break;case a.MouseEvents.MOVE:var g=this.points.x1,h=this.points.y1,i=Math.min(e,g),j=Math.min(f,h),k=Math.max(e,g),l=Math.max(f,h),m=Math.max(Math.abs(k-i),Math.abs(l-j));d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("r",m);break;case a.MouseEvents.END:this.numberOfObjects++,this.clearPoints()}return this},b.prototype.drawEllipse=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"ellipse"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill",this.attributes.fill),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("cx",e),d.setAttribute("cy",f),this.container.querySelector("svg").appendChild(d),this.points.x1=e,this.points.y1=f;break;case a.MouseEvents.MOVE:var g=this.points.x1,h=this.points.y1,i=Math.min(e,g),j=Math.min(f,h),k=Math.max(e,g),l=Math.max(f,h),m=Math.abs(k-i),n=Math.abs(l-j);d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("rx",m),d.setAttribute("ry",n);break;case a.MouseEvents.END:this.numberOfObjects++,this.clearPoints()}return this},b.prototype.drawLine=function(c){if(!(c instanceof Event))return this;var d=null,e=b.getOffsetX(c,this.container),f=b.getOffsetY(c,this.container);switch(c.type){case a.MouseEvents.START:d=document.createElementNS(a.XMLNS,"line"),d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill","none"),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("stroke-width",this.attributes["stroke-width"]),d.setAttribute("stroke-linejoin",this.attributes["stroke-linejoin"]),this.container.querySelector("svg").appendChild(d),this.points.x1=e,this.points.y1=f;break;case a.MouseEvents.MOVE:var g=this.points.x1,h=this.points.y1;d=document.getElementById(b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("stroke-linecap",this.attributes["stroke-linecap"]),d.setAttribute("x1",g),d.setAttribute("y1",h),d.setAttribute("x2",e),d.setAttribute("y2",f);break;case a.MouseEvents.END:this.numberOfObjects++,this.clearPoints()}return this},b.prototype.drawText=function(c){if(c.type!==a.MouseEvents.START)return this;var d=document.createElementNS(a.XMLNS,"text");d.setAttribute("id",b.ELEMENT_ID_PREFIX+this.numberOfObjects),d.setAttribute("fill",this.attributes.fill),d.setAttribute("stroke",this.attributes.stroke),d.setAttribute("x",b.getOffsetX(c,this.container)),d.setAttribute("y",b.getOffsetY(c,this.container));for(var e in this.font)d.style[e]=this.font[e];var f=document.createElement("input");return f.setAttribute("type","text"),f.style.position="absolute",f.style.top=c.pageY-12+"px",f.style.left=c.pageX-8+"px",f.style.zIndex="2",f.style.cursor="text",f.style.opacity="0",f.oninput=function(){d.textContent=this.value},this.container.querySelector("svg").appendChild(d),this.container.appendChild(f),this.numberOfObjects++,this},b.prototype.drawImage=function(c,d,e){var f=parseFloat(d),g=parseFloat(e);isNaN(f)&&(f=0),isNaN(g)&&(g=0);var h=new Image,i=this;return h.src=c,h.onload=function(){var d=document.createElementNS(a.XMLNS,"image");d.setAttributeNS(a.XLINK,"xlink:href",String(c)),d.setAttributeNS(null,"id",b.ELEMENT_ID_PREFIX+i.numberOfObjects),d.setAttributeNS(null,"x",f),d.setAttributeNS(null,"y",g),d.setAttributeNS(null,"width",this.width),d.setAttributeNS(null,"height",this.height),i.container.querySelector("svg").appendChild(d),i.numberOfObjects++},this},b.prototype.movePath=function(a,b,c){for(var d=a.getAttribute("d").split(", "),e=function(a){for(var b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=Number.MIN_VALUE,f=0,g=a.length;g>f;f++){var h=a[f].split(" "),i=parseFloat(h[0].slice(1)),j=parseFloat(h[1]);b>i&&(b=i),c>j&&(c=j),i>d&&(d=i),j>e&&(e=j)}return{minX:b,minY:c,maxX:d,maxY:e}},f=e(d),g=(f.maxX-f.minX)/2+f.minX,h=(f.maxY-f.minY)/2+f.minY,i=b-g,j=c-h,k=0,l=d.length;l>k;k++){var m=d[k].split(" "),n=parseFloat(m[0].slice(1))+i,o=parseFloat(m[1])+j;0===k?a.setAttribute("d","M"+n+" "+o):a.setAttribute("d",a.getAttribute("d")+", L"+n+" "+o)}return this},b.prototype.moveRectangle=function(a,b,c){var d=parseFloat(a.getAttribute("width")),e=parseFloat(a.getAttribute("height"));return a.setAttribute("x",b-d/2),a.setAttribute("y",c-e/2),this},b.prototype.moveEllipse=function(a,b,c){return a.setAttribute("cx",b),a.setAttribute("cy",c),this},b.prototype.moveLine=function(a,b,c){var d=parseFloat(a.getAttribute("x1")),e=parseFloat(a.getAttribute("x2")),f=parseFloat(a.getAttribute("y1")),g=parseFloat(a.getAttribute("y2")),h=Math.abs(e-d)/2+Math.min(e,d),i=Math.abs(g-f)/2+Math.min(g,f),j=b-h,k=c-i,l=d+j,m=e+j,n=f+k,o=g+k;return a.setAttribute("x1",l),a.setAttribute("x2",m),a.setAttribute("y1",n),a.setAttribute("y2",o),this},b.prototype.moveText=function(a,b,c){return a.setAttribute("x",b-10),a.setAttribute("y",c+10),this},b.prototype.moveImage=function(a,b,c){var d=parseFloat(a.getAttributeNS(null,"width")),e=parseFloat(a.getAttributeNS(null,"height"));return a.setAttributeNS(null,"x",b-d/2),a.setAttributeNS(null,"y",c-e/2),this},b.prototype.clear=function(){return this.container.querySelector("svg").innerHTML="",this},b.prototype.clearPoints=function(){return this.points.x1=0,this.points.y1=0,this},b.prototype.getFill=function(){return this.attributes.fill},b.prototype.setFill=function(a){return this.attributes.fill=String(a),this},b.prototype.getStroke=function(){return this.attributes.stroke},b.prototype.setStroke=function(a){return this.attributes.stroke=String(a),this},b.prototype.getStrokeWidth=function(){return this.attributes["stroke-width"]},b.prototype.setStrokeWidth=function(a){var b=parseFloat(a);return b>=0&&(this.attributes["stroke-width"]=b),this},b.prototype.getStrokeLinecap=function(){return this.attributes["stroke-linecap"]},b.prototype.setStrokeLinecap=function(a){return String(a).toUpperCase()in b.StrokeLinecap&&(this.attributes["stroke-linecap"]=a.toLowerCase()),this},b.prototype.getStrokeLinejoin=function(){return this.attributes["stroke-linejoin"]},b.prototype.setStrokeLinejoin=function(a){return String(a).toUpperCase()in b.StrokeLinejoin&&(this.attributes["stroke-linejoin"]=a.toLowerCase()),this},b.prototype.getFontFamily=function(){return this.font["font-family"]},b.prototype.setFontFamily=function(a){return this.font["font-family"]=String(a),this},b.prototype.getFontSize=function(){return this.font["font-size"]},b.prototype.setFontSize=function(a){return this.font["font-size"]=String(a),this},b.prototype.getFontStyle=function(){return this.font["font-style"]},b.prototype.setFontStyle=function(a){return String(a).toUpperCase()in b.FontStyle&&(this.font["font-style"]=a.toLowerCase()),this},b.prototype.getFontWeight=function(){return this.font["font-weight"]},b.prototype.setFontWeight=function(a){return this.font["font-weight"]=String(a),this},b.getOffsetX=function(a,b){return a instanceof Event&&b instanceof HTMLElement?(a.pageX||(a.touches[0]?a=a.touches[0]:a.changedTouches[0]&&(a=a.changedTouches[0])),a.pageX-b.offsetLeft+b.scrollLeft):0},b.getOffsetY=function(a,b){return a instanceof Event&&b instanceof HTMLElement?(a.pageY||(a.touches[0]?a=a.touches[0]:a.changedTouches[0]&&(a=a.changedTouches[0])),a.pageY-b.offsetTop+b.scrollTop):0},c.PATH="path",c.RECTANGLE="rectangle",c.SQUARE="square",c.CIRCLE="circle",c.ELLIPSE="ellipse",c.LINE="line",c.TEXT="text",b.Type=c,d.BUTT="butt",d.ROUND="round",d.SQUARE="square",b.StrokeLinecap=d,e.MITER="miter",e.ROUND="round",e.BEVEL="bevel",b.StrokeLinejoin=e,f.NORMAL="normal",f.ITALIC="italic",f.OBLIQUE="oblique",b.FontStyle=f,a.Drawer=b}(b),function(a){function b(a){this.svg=null,a instanceof SVGElement?this.svg=a:this.svg=document.createElement("svg"),this.histories=[this.svg.innerHTML],this.pointer=0}b.prototype.updateHistory=function(){return this.histories[++this.pointer]=this.svg.innerHTML,this.pointer<this.histories.length-1&&(this.histories=this.histories.slice(0,this.pointer+1)),this},b.prototype.undo=function(){return this.pointer>0?(this.svg.innerHTML=this.histories[--this.pointer],!0):!1},b.prototype.redo=function(){return this.pointer<this.histories.length-1?(this.svg.innerHTML=this.histories[++this.pointer],!0):!1},a.History=b}(b),a.ArtSVG=b}(window);
//# sourceMappingURL=ArtSVG.js.map